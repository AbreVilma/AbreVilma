<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carousel Vertical Corregido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .carousel-wrapper {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .carousel-container {
            height: 80vh;
            /* Cambio principal: usar aspect-ratio en lugar de width basado en vh */
            aspect-ratio: 3/4;
            max-width: 450px;
            max-height: 600px; /* Límite máximo para pantallas muy grandes */
            position: relative;
            overflow: hidden;
            cursor: grab;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            touch-action: pan-y;
            user-select: none;
            margin: 0 auto;
        }

        .carousel-container:active {
            cursor: grabbing;
        }

        .carousel-track {
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            will-change: transform;
        }

        .carousel-slide {
            display: block;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .carousel-slide img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            pointer-events: none;
            user-select: none;
            border-radius: 10px;
        }

        .carousel-arrow {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .carousel-arrow:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(-50%) scale(1.1);
        }

        .carousel-arrow.up {
            top: 10px;
        }

        .carousel-arrow.down {
            bottom: 10px;
        }

        .carousel-arrow svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .carousel-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Media queries ajustadas */
        @media (max-width: 768px) {
            .carousel-wrapper {
                flex-direction: column;
                gap: 15px;
            }

            .carousel-container {
                height: 60vh;
                max-width: 300px;
                margin: 0 20px;
            }
        }

        @media (max-width: 480px) {
            .carousel-container {
                height: 50vh;
                max-width: 250px;
                margin: 0 15px;
            }
        }

        /* Media query específica para pantallas grandes */
        @media (min-width: 1200px) {
            .carousel-container {
                height: 80vh; /* Mantener la misma altura que el base */
                max-height: 600px; /* Altura máxima más conservadora */
                max-width: 450px; /* Mantener proporción 3:4 */
            }
        }
    </style>
</head>
<body>
    <div class="carousel-wrapper">
        <div class="carousel-container" id="carouselContainer">
            <!-- Flecha hacia arriba -->
            <button class="carousel-arrow up" id="arrowUp">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M7 14l5-5 5 5z"/>
                </svg>
            </button>
            
            <div class="carousel-track" id="carouselTrack">
                <!-- Las imágenes se cargarán aquí -->
            </div>
            
            <!-- Flecha hacia abajo -->
            <button class="carousel-arrow down" id="arrowDown">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M7 10l5 5 5-5z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Variables del carousel
        let currentIndex = 0;
        let currentCategory = 'category1';
        let isDragging = false;
        let startPosY = 0;
        let currentTranslate = 0;
        let prevTranslate = 0;
        let animationFrame = 0;

        // Elementos del DOM
        const carouselContainer = document.getElementById('carouselContainer');
        const carouselTrack = document.getElementById('carouselTrack');
        const arrowUp = document.getElementById('arrowUp');
        const arrowDown = document.getElementById('arrowDown');

        // Datos de ejemplo (simula tus categorías)
        const categories = {
            'category1': 5 // 5 imágenes de ejemplo
        };

        // Imágenes de ejemplo
        const sampleImages = [
            'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=600&fit=crop',
            'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=600&fit=crop',
            'https://images.unsplash.com/photo-1501436513145-30f24e19fcc4?w=400&h=600&fit=crop',
            'https://images.unsplash.com/photo-1448375240586-882707db888b?w=400&h=600&fit=crop',
            'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=600&fit=crop'
        ];

        // Inicialización
        function init() {
            loadImages();
            // Esperar a que las imágenes se carguen antes de calcular posiciones
            setTimeout(() => {
                updateSlideHeights();
                setPositionByIndex();
                updateArrows();
            }, 100);
            addEventListeners();
        }

        // Cargar imágenes
        function loadImages() {
            carouselTrack.innerHTML = '';
            
            for (let i = 0; i < categories[currentCategory]; i++) {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                
                const img = document.createElement('img');
                img.src = sampleImages[i % sampleImages.length];
                img.alt = `Imagen ${i + 1}`;
                
                slide.appendChild(img);
                carouselTrack.appendChild(slide);
            }
        }

        // Función corregida para calcular la posición
        function setPositionByIndex() {
            // Usar clientHeight para obtener la altura real del contenedor
            const containerHeight = carouselContainer.clientHeight;
            // Redondear para evitar decimales que causen desalineación
            currentTranslate = Math.round(currentIndex * -containerHeight);
            prevTranslate = currentTranslate;
            carouselTrack.style.transform = `translateY(${currentTranslate}px)`;
        }

        // Event listeners para touch/mouse
        function addEventListeners() {
            // Touch events
            carouselContainer.addEventListener('touchstart', touchStart, { passive: false });
            carouselContainer.addEventListener('touchmove', touchMove, { passive: false });
            carouselContainer.addEventListener('touchend', touchEnd);

            // Mouse events
            carouselContainer.addEventListener('mousedown', touchStart);
            carouselContainer.addEventListener('mousemove', touchMove);
            carouselContainer.addEventListener('mouseup', touchEnd);
            carouselContainer.addEventListener('mouseleave', touchEnd);

            // Arrows
            arrowUp.addEventListener('click', goToPrevious);
            arrowDown.addEventListener('click', goToNext);

            // Resize event para recalcular posiciones
            window.addEventListener('resize', handleResize);
        }

        // Manejar redimensionamiento de ventana
        function handleResize() {
            // Esperar a que el CSS se aplique y recalcular con más precisión
            setTimeout(() => {
                // Forzar un reflow para obtener medidas exactas
                carouselContainer.offsetHeight;
                setPositionByIndex();
                // Asegurar que las imágenes tengan la altura correcta
                updateSlideHeights();
            }, 150);
        }

        // Nueva función para asegurar que las slides tengan la altura correcta
        function updateSlideHeights() {
            const slides = carouselTrack.querySelectorAll('.carousel-slide');
            const containerHeight = carouselContainer.clientHeight;
            
            slides.forEach(slide => {
                slide.style.height = `${containerHeight}px`;
            });
        }

        function touchStart(event) {
            if (event.target.closest('.carousel-arrow')) {
                return;
            }

            event.preventDefault();
            isDragging = true;
            startPosY = getPosition(event);
            carouselTrack.style.transition = 'none';
            cancelAnimationFrame(animationFrame);
            animationFrame = requestAnimationFrame(animation);
        }

        function touchMove(event) {
            if (isDragging) {
                event.preventDefault();
                const currentPosition = getPosition(event);
                currentTranslate = prevTranslate + currentPosition - startPosY;
            }
        }

        function touchEnd() {
            if (!isDragging) return;
            
            isDragging = false;
            cancelAnimationFrame(animationFrame);
            
            const movedBy = currentTranslate - prevTranslate;
            const containerHeight = carouselContainer.clientHeight;
            const threshold = containerHeight * 0.15;

            // Navegar hacia abajo (siguiente imagen)
            if (movedBy < -threshold && currentIndex < categories[currentCategory] - 1) {
                currentIndex += 1;
            }
            // Navegar hacia arriba (imagen anterior)
            else if (movedBy > threshold && currentIndex > 0) {
                currentIndex -= 1;
            }
            
            carouselTrack.style.transition = 'transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1)';
            setPositionByIndex();
            updateArrows();
        }

        function getPosition(event) {
            return event.type.includes('mouse') ? event.clientY : event.touches[0].clientY;
        }

        function animation() {
            if (isDragging) {
                carouselTrack.style.transform = `translateY(${currentTranslate}px)`;
                animationFrame = requestAnimationFrame(animation);
            }
        }

        function goToPrevious() {
            if (currentIndex > 0) {
                currentIndex -= 1;
                setPositionByIndex();
                updateArrows();
            }
        }

        function goToNext() {
            if (currentIndex < categories[currentCategory] - 1) {
                currentIndex += 1;
                setPositionByIndex();
                updateArrows();
            }
        }

        function updateArrows() {
            arrowUp.disabled = currentIndex === 0;
            arrowDown.disabled = currentIndex === categories[currentCategory] - 1;
        }

        // Inicializar cuando la página cargue
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>